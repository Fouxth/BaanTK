<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔍 Debug LIFF API</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold text-center mb-6">🔍 Debug LIFF API</h1>
        
        <div class="space-y-4">
            <button onclick="testAPI()" class="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">
                🧪 Test API Endpoint
            </button>
            
            <button onclick="testCORS()" class="w-full bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600">
                🌐 Test CORS
            </button>
            
            <button onclick="testFormData()" class="w-full bg-purple-500 text-white py-2 px-4 rounded hover:bg-purple-600">
                📝 Test Form Data
            </button>
        </div>
        
        <div id="results" class="mt-6 p-4 bg-gray-100 rounded min-h-32">
            <p class="text-gray-500">คลิกปุ่มเพื่อเริ่มทестได้</p>
        </div>
    </div>

    <script>
        const log = (message) => {
            const results = document.getElementById('results');
            results.innerHTML += `<p class="mb-2">${new Date().toLocaleTimeString()}: ${message}</p>`;
            results.scrollTop = results.scrollHeight;
        };

        const clearLog = () => {
            document.getElementById('results').innerHTML = '';
        };

        async function testAPI() {
            clearLog();
            log('🧪 เริ่มทดสอบ API endpoint...');
            
            const urls = [
                'https://us-central1-baan-tk.cloudfunctions.net/api/liff-register',
                'https://webhook-kkrrpg5icq-uc.a.run.app/api/liff-register',
                'http://localhost:5001/baan-tk/us-central1/api/liff-register'
            ];
            
            for (const url of urls) {
                try {
                    log(`📡 ทดสอบ: ${url}`);
                    
                    const response = await fetch(url, {
                        method: 'OPTIONS',
                        headers: {
                            'Content-Type': 'application/json',
                            'Origin': window.location.origin
                        }
                    });
                    
                    log(`✅ ${url} - Status: ${response.status}`);
                    
                } catch (error) {
                    log(`❌ ${url} - Error: ${error.message}`);
                }
            }
        }

        async function testCORS() {
            clearLog();
            log('🌐 เริ่มทดสอบ CORS...');
            
            try {
                const response = await fetch('https://us-central1-baan-tk.cloudfunctions.net/api/liff-register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': window.location.origin
                    },
                    body: JSON.stringify({ test: 'data' })
                });
                
                log(`✅ CORS OK - Status: ${response.status}`);
                const text = await response.text();
                log(`📄 Response: ${text.substring(0, 100)}...`);
                
            } catch (error) {
                log(`❌ CORS Error: ${error.message}`);
            }
        }

        async function testFormData() {
            clearLog();
            log('📝 เริ่มทดสอบ Form Data...');
            
            const testData = {
                firstName: 'ทดสอบ',
                lastName: 'ระบบ',
                birthDate: '01/01/1990',
                idCard: '1234567890123',
                address: 'ที่อยู่ทดสอบ',
                amount: 10000,
                frequency: 'monthly',
                userId: 'test-user-id'
            };
            
            try {
                log('📤 ส่งข้อมูลทดสอบ...');
                
                const response = await fetch('https://us-central1-baan-tk.cloudfunctions.net/api/liff-register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                log(`📨 Status: ${response.status}`);
                
                if (response.ok) {
                    const result = await response.json();
                    log(`✅ Success: ${JSON.stringify(result)}`);
                } else {
                    const error = await response.text();
                    log(`❌ Error: ${error}`);
                }
                
            } catch (error) {
                log(`❌ Exception: ${error.message}`);
            }
        }

        // Auto test on load
        window.onload = () => {
            log('🚀 Debug tool พร้อมใช้งาน');
            log('💡 เปิด Browser DevTools (F12) เพื่อดู console logs');
        };
    </script>
</body>
</html>
