<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Debug LIFF API</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold text-center mb-6">ğŸ” Debug LIFF API</h1>
        
        <div class="space-y-4">
            <button onclick="testAPI()" class="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">
                ğŸ§ª Test API Endpoint
            </button>
            
            <button onclick="testCORS()" class="w-full bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600">
                ğŸŒ Test CORS
            </button>
            
            <button onclick="testFormData()" class="w-full bg-purple-500 text-white py-2 px-4 rounded hover:bg-purple-600">
                ğŸ“ Test Form Data
            </button>
        </div>
        
        <div id="results" class="mt-6 p-4 bg-gray-100 rounded min-h-32">
            <p class="text-gray-500">à¸„à¸¥à¸´à¸à¸›à¸¸à¹ˆà¸¡à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸—ĞµÑÑ‚à¹„à¸”à¹‰</p>
        </div>
    </div>

    <script>
        const log = (message) => {
            const results = document.getElementById('results');
            results.innerHTML += `<p class="mb-2">${new Date().toLocaleTimeString()}: ${message}</p>`;
            results.scrollTop = results.scrollHeight;
        };

        const clearLog = () => {
            document.getElementById('results').innerHTML = '';
        };

        async function testAPI() {
            clearLog();
            log('ğŸ§ª à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸”à¸ªà¸­à¸š API endpoint...');
            
            const urls = [
                'https://us-central1-baan-tk.cloudfunctions.net/api/liff-register',
                'https://webhook-kkrrpg5icq-uc.a.run.app/api/liff-register',
                'http://localhost:5001/baan-tk/us-central1/api/liff-register'
            ];
            
            for (const url of urls) {
                try {
                    log(`ğŸ“¡ à¸—à¸”à¸ªà¸­à¸š: ${url}`);
                    
                    const response = await fetch(url, {
                        method: 'OPTIONS',
                        headers: {
                            'Content-Type': 'application/json',
                            'Origin': window.location.origin
                        }
                    });
                    
                    log(`âœ… ${url} - Status: ${response.status}`);
                    
                } catch (error) {
                    log(`âŒ ${url} - Error: ${error.message}`);
                }
            }
        }

        async function testCORS() {
            clearLog();
            log('ğŸŒ à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸”à¸ªà¸­à¸š CORS...');
            
            try {
                const response = await fetch('https://us-central1-baan-tk.cloudfunctions.net/api/liff-register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': window.location.origin
                    },
                    body: JSON.stringify({ test: 'data' })
                });
                
                log(`âœ… CORS OK - Status: ${response.status}`);
                const text = await response.text();
                log(`ğŸ“„ Response: ${text.substring(0, 100)}...`);
                
            } catch (error) {
                log(`âŒ CORS Error: ${error.message}`);
            }
        }

        async function testFormData() {
            clearLog();
            log('ğŸ“ à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸”à¸ªà¸­à¸š Form Data...');
            
            const testData = {
                firstName: 'à¸—à¸”à¸ªà¸­à¸š',
                lastName: 'à¸£à¸°à¸šà¸š',
                birthDate: '01/01/1990',
                idCard: '1234567890123',
                address: 'à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¸—à¸”à¸ªà¸­à¸š',
                amount: 10000,
                frequency: 'monthly',
                userId: 'test-user-id'
            };
            
            try {
                log('ğŸ“¤ à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸”à¸ªà¸­à¸š...');
                
                const response = await fetch('https://us-central1-baan-tk.cloudfunctions.net/api/liff-register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                log(`ğŸ“¨ Status: ${response.status}`);
                
                if (response.ok) {
                    const result = await response.json();
                    log(`âœ… Success: ${JSON.stringify(result)}`);
                } else {
                    const error = await response.text();
                    log(`âŒ Error: ${error}`);
                }
                
            } catch (error) {
                log(`âŒ Exception: ${error.message}`);
            }
        }

        // Auto test on load
        window.onload = () => {
            log('ğŸš€ Debug tool à¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™');
            log('ğŸ’¡ à¹€à¸›à¸´à¸” Browser DevTools (F12) à¹€à¸à¸·à¹ˆà¸­à¸”à¸¹ console logs');
        };
    </script>
</body>
</html>
