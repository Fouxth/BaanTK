# ЁЯФз LINE Bot Setup Guide - р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ LINE Bot р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Й Auto-Reply р╕Чр╕│р╕Зр╕▓р╕Щ

## тЪая╕П р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕Юр╕Ъ: "р╕Юр╕┤р╕бр╕Юр╣Мр╣Бр╕ер╣Йр╕зр╣Др╕бр╣Ир╕бр╕╡р╕Бр╕▓р╕гр╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ"

р╕лр╕▓р╕Бр╕Др╕╕р╕Ур╕Юр╕┤р╕бр╕Юр╣Мр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕Щ LINE р╣Бр╕ер╣Йр╕зр╕Ър╕нр╕Чр╣Др╕бр╣Ир╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ р╣Бр╕кр╕Фр╕Зр╕зр╣Ир╕▓р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Гр╕Щ LINE Developers Console р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

## ЁЯОп р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕В

### 1. р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣И LINE Developers Console

1. р╣Др╕Ыр╕Чр╕╡р╣И [LINE Developers](https://developers.line.biz/)
2. Login р╕Фр╣Йр╕зр╕вр╕Ър╕▒р╕Нр╕Кр╕╡ LINE р╕Вр╕нр╕Зр╕Др╕╕р╕У
3. р╣Ар╕ер╕╖р╕нр╕Б Provider р╣Бр╕ер╕░ Channel р╕Вр╕нр╕Зр╕Др╕╕р╕У

### 2. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Messaging API (р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕кр╕│р╕Др╕▒р╕Н!)

1. р╣Др╕Ыр╕Чр╕╡р╣И **Messaging API** tab
2. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Фр╕▒р╕Зр╕Щр╕╡р╣Й:

#### ЁЯМР Webhook Settings
```
Webhook URL: https://webhook-kkrrpg5icq-uc.a.run.app/webhook
Use webhook: тЬЕ р╣Ар╕Ыр╕┤р╕Ф (р╕кр╕│р╕Др╕▒р╕Нр╕бр╕▓р╕Б!)
Redelivery: тЬЕ р╣Ар╕Ыр╕┤р╕Ф (р╣Бр╕Щр╕░р╕Щр╕│)
```

#### ЁЯдЦ Response Settings  
```
Auto-reply messages: тЭМ р╕Ыр╕┤р╕Ф (р╕Хр╣Йр╕нр╕Зр╕Ыр╕┤р╕Фр╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╣Гр╕Кр╣Йр╕гр╕░р╕Ър╕Ър╣Ар╕гр╕▓)
Greeting messages: тЭМ р╕Ыр╕┤р╕Ф (р╕Хр╣Йр╕нр╕Зр╕Ыр╕┤р╕Фр╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╣Гр╕Кр╣Йр╕гр╕░р╕Ър╕Ър╣Ар╕гр╕▓)
```

#### ЁЯФС Channel Access Token
```
- р╕Др╕ер╕┤р╕Б "Issue" р╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕З Channel Access Token р╣Гр╕лр╕бр╣И
- Copy token р╕Щр╕╡р╣Йр╣Др╕Ыр╣Гр╕кр╣Ир╣Гр╕Щр╣Др╕Яр╕ер╣М .env
```

### 3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Environment Variables

р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Др╕Яр╕ер╣М `/functions/.env` р╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З:

```env
LINE_CHANNEL_ACCESS_TOKEN=your-long-channel-access-token-here
LINE_CHANNEL_SECRET=your-channel-secret-here
```

### 4. р╕Чр╕Фр╕кр╕нр╕Ъ Webhook Connection

1. р╣Гр╕Щ LINE Developers Console р╣Др╕Ыр╕Чр╕╡р╣И **Messaging API** tab
2. р╣Гр╕Щр╕кр╣Ир╕зр╕Щ **Webhook settings** р╕Др╕ер╕┤р╕Б **Verify**
3. р╕Др╕зр╕гр╣Др╕Фр╣Йр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М "Success" р╕лр╕гр╕╖р╕н status code 200

### 5. р╕Чр╕Фр╕кр╕нр╕Ър╣Гр╕Щ LINE App

1. р╕кр╣Бр╕Бр╕Щ QR Code р╕лр╕гр╕╖р╕нр╣Ар╕Юр╕┤р╣Ир╕бр╕Ър╕нр╕Чр╕Ир╕▓р╕Б LINE ID
2. р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б "р╕кр╕зр╕▒р╕кр╕Фр╕╡" - р╕Др╕зр╕гр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ъ
3. р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б "р╣Ар╕бр╕Щр╕╣" - р╕Др╕зр╕гр╣Др╕Фр╣Йр╕гр╕▒р╕Ъ Flex Message menu

## ЁЯЪи Common Issues & Solutions

### Issue 1: Webhook Verification Failed
**р╕кр╕▓р╣Ар╕лр╕Хр╕╕:** URL р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕н Firebase Function р╣Др╕бр╣Ир╕Чр╕│р╕Зр╕▓р╕Щ
**р╣Бр╕Бр╣Йр╣Др╕В:** 
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ URL р╕Др╕╖р╕н `https://webhook-kkrrpg5icq-uc.a.run.app/webhook`
- р╕гр╕▒р╕Щ `firebase deploy --only functions` р╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З

### Issue 2: р╕Ър╕нр╕Чр╣Др╕бр╣Ир╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ
**р╕кр╕▓р╣Ар╕лр╕Хр╕╕:** Auto-reply messages р╕вр╕▒р╕Зр╣Ар╕Ыр╕┤р╕Фр╕нр╕вр╕╣р╣И
**р╣Бр╕Бр╣Йр╣Др╕В:**
- р╣Др╕Ыр╕Чр╕╡р╣И LINE Developers Console
- р╕Ыр╕┤р╕Ф "Auto-reply messages" р╣Бр╕ер╕░ "Greeting messages"
- р╣Ар╕Ыр╕┤р╕Ф "Use webhook" р╣Гр╕лр╣Йр╣Бр╕Щр╣Ир╣Гр╕И

### Issue 3: р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б Default Reply
**р╕кр╕▓р╣Ар╕лр╕Хр╕╕:** Channel Access Token р╕лр╕гр╕╖р╕н Secret р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
**р╣Бр╕Бр╣Йр╣Др╕В:**
- р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х token р╣Гр╕лр╕бр╣Ир╣Гр╕Щ `.env`
- Deploy р╣Гр╕лр╕бр╣И: `firebase deploy --only functions`

### Issue 4: Error 403 Forbidden
**р╕кр╕▓р╣Ар╕лр╕Хр╕╕:** Channel Access Token р╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕р╕лр╕гр╕╖р╕нр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
**р╣Бр╕Бр╣Йр╣Др╕В:**
- р╕кр╕гр╣Йр╕▓р╕З Channel Access Token р╣Гр╕лр╕бр╣И
- р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╣Гр╕Щр╣Др╕Яр╕ер╣М `.env`

## ЁЯФН р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ыр╕▒р╕Нр╕лр╕▓

### 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Firebase Logs
```bash
# р╕Фр╕╣ logs р╣Гр╕Щ terminal
firebase functions:log --only webhook

# р╕лр╕гр╕╖р╕нр╕Фр╕╣р╣Гр╕Щ web console
# https://console.firebase.google.com/project/baan-tk/functions/logs
```

### 2. р╕Чр╕Фр╕кр╕нр╕Ъ Webhook р╕Ир╕▓р╕Б Terminal
```bash
node test-realistic-webhook.js
```

### 3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ LINE Webhook Status
р╣Гр╕Щ LINE Developers Console р╕Фр╕╣р╕Чр╕╡р╣И **Webhook settings** -> **Verify**

## ЁЯУ▒ р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

### р╕ер╕│р╕Фр╕▒р╕Ър╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ:
1. **р╣Ар╕Юр╕┤р╣Ир╕бр╕Ър╕нр╕Чр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╕Щ** тЖТ р╕Др╕зр╕гр╣Др╕Фр╣Йр╕гр╕▒р╕Ъ welcome message
2. **р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б "р╕кр╕зр╕▒р╕кр╕Фр╕╡"** тЖТ р╕Др╕зр╕гр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕▒р╕Бр╕Чр╕▓р╕в
3. **р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б "р╣Ар╕бр╕Щр╕╣"** тЖТ р╕Др╕зр╕гр╣Др╕Фр╣Йр╕гр╕▒р╕Ъ Flex Message carousel
4. **р╕Бр╕Фр╕Ыр╕╕р╣Ир╕бр╣Гр╕Щр╣Ар╕бр╕Щр╕╣** тЖТ р╕Др╕зр╕гр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Вр╣Йр╕нр╕З

### р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╕гр╕нр╕Зр╕гр╕▒р╕Ъ:
- **р╕кр╕зр╕▒р╕кр╕Фр╕╡, Hello, Hi** тЖТ р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ъ
- **р╣Ар╕бр╕Щр╕╣, Menu** тЖТ р╣Ар╕бр╕Щр╕╣р╕лр╕ер╕▒р╕Б  
- **р╕кр╕бр╕▒р╕Др╕г, Register** тЖТ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕кр╕бр╕▒р╕Др╕г
- **р╕кр╕Цр╕▓р╕Щр╕░, Status** тЖТ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕Цр╕▓р╕Щр╕░
- **р╕Кр╕│р╕гр╕░, Payment** тЖТ р╕кр╣Ир╕Зр╕кр╕ер╕┤р╕Ыр╕Бр╕▓р╕гр╕Кр╕│р╕гр╕░
- **р╕Хр╕┤р╕Фр╕Хр╣Ир╕н, Contact** тЖТ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕┤р╕Фр╕Хр╣Ир╕н
- **р╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕В, Terms** тЖТ р╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕Вр╕Ър╕гр╕┤р╕Бр╕▓р╕г
- **р╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Бр╕▒р╕Ъ, About** тЖТ р╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Бр╕▒р╕Ър╕Ър╕гр╕┤р╕йр╕▒р╕Ч

## ЁЯУК р╕кр╕Цр╕▓р╕Щр╕░р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╕Вр╕нр╕Зр╕гр╕░р╕Ър╕Ъ

тЬЕ **Firebase Functions:** Deploy р╕кр╕│р╣Ар╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з
тЬЕ **Webhook Endpoint:** https://webhook-kkrrpg5icq-uc.a.run.app/webhook
тЬЕ **Auto-Reply Logic:** р╕Чр╕│р╕Зр╕▓р╕Щр╣Др╕Фр╣Й 100%  
тЬЕ **Flex Messages:** р╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ
тЬЕ **Event Handling:** р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ

## ЁЯОп р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕кр╕╕р╕Фр╕Чр╣Йр╕▓р╕в

1. **р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ LINE Developers Console** р╕Хр╕▓р╕бр╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Вр╣Йр╕▓р╕Зр╕Хр╣Йр╕Щ
2. **р╕Чр╕Фр╕кр╕нр╕Ъ Webhook Verification** р╣Гр╕Щ LINE Console
3. **р╕Чр╕Фр╕кр╕нр╕Ър╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б** р╣Гр╕Щ LINE App
4. **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Logs** р╣Гр╕Щ Firebase Console

---

ЁЯФе **р╕лр╕▓р╕Бр╕Чр╕│р╕Хр╕▓р╕бр╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╣Бр╕ер╣Йр╕зр╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Др╕Фр╣Йр╕Ьр╕е:**

1. р╣Бр╕Кр╕гр╣Мр╕лр╕Щр╣Йр╕▓р╕Ир╕н LINE Developers Console
2. р╕кр╣Ир╕З screenshot р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Webhook 
3. р╕кр╣Ир╕З Firebase Console logs
4. р╕гр╕░р╕Ър╕╕р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╕кр╣Ир╕Зр╣Бр╕ер╕░р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╣Др╕Фр╣Й

**р╕гр╕░р╕Ър╕Ър╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ 100% р╣Бр╕ер╣Йр╕з! р╕Ыр╕▒р╕Нр╕лр╕▓р╕Щр╣Ир╕▓р╕Ир╕░р╕нр╕вр╕╣р╣Ир╕Чр╕╡р╣Ир╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ LINE Console р╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ** тЬи
